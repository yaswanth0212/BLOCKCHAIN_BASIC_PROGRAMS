<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<title>FOOD SUPPLYCHAIN</title>
<style>
* {
  box-sizing: border-box;
}

body {
  margin: 0;
}

.button {
  background-color: #f44336;
  border: none;
  color: white;
  padding: 6px 10px;
  text-align: center;
  text-decoration: underline;
  display: inline-block;
  font-size: 15px;
  margin: 4px 2px;
  cursor: pointer;
}
.button2{
  background-color: green;
  border: none;
  color: white;
  padding: 6px 10px;
  text-align: center;
  text-decoration: underline;
  display: inline-block;
  font-size: 15px;
  margin: 4px 2px;
  cursor: pointer;
}
.button4 {
  background-color: #f44336;
  border: none;
  color: white;
  padding: 26px 30px;
  text-align: center;
  text-decoration: underline;
  display: inline-block;
  font-size: 35px;
  margin: 4px 2px;
   margin: 0;
  position: absolute;
  top: 80%;
  left: 78%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
  cursor: pointer;
  
}
.button1 {
  background-color: #f44336;
  border: none;
  color: white;
  padding: 26px 30px;
  text-align: center;
  text-decoration: underline;
  display: inline-block;
  font-size: 35px;
  margin: 4px 2px;
   margin: 0;
  position: absolute;
  top: 10%;
  left: 5%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
  cursor: pointer;
  
}
/* Style the header */
.header {
  background-color: Yellow;
  padding: 20px;
  text-align: center;
  color: Black;
  font:bold;
}


/* Style the top navigation bar */
.topnav {
  overflow: hidden;
  background-color: #333;
}

/* Style the topnav links */
.topnav a {
  float: left;
  display: block;
  color: #f2f2f2;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
}

/* Change color on hover */
.topnav a:hover {
  background-color: #ddd;
  color: black;
  
}

/* Create three equal columns that floats next to each other */
.column {
  float: left;
  width: 65%;
  padding: 15px;
}body {
  background-image: url('1.png');
background-repeat: no-repeat;
  background-attachment: fixed;
  background-size: cover;}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

/* Responsive layout - makes the three columns stack on top of each other instead of next to each other */
@media screen and (max-width:600px) {
  .column {
    width: 100%;
  }
}
</style>
<script>
        function testVariable() {
        var myContract = new web3.eth.Contract(abi,contract_address,{from: account, gasPrice: '500000', gas:'500000'});            
		var foodtype=document.getElementById("food_type").value;
		var foodname=document.getElementById("food_name").value;
  		var foodplace=document.getElementById("food_place").value;
		var foodpesticides=document.getElementById("food_pesticides").value;
		var producername=document.getElementById("producer_name").value;
  		var result = myContract.methods.addProductDetails(foodtype,foodname,foodplace,foodpesticides,producername).send(function (err, result) {
        if (err) { console.log(err); }
        if (result) { document.getElementById("result").innerHTML = result; }   
                
				}); 
        }
    </script>
	 <script src="https://cdn.jsdelivr.net/npm/web3@1.2.8/dist/web3.js"></script>
    <script>	
	
	var account;
	window.addEventListener('load', async () => {

	
		if (typeof window.ethereum !== 'undefined') { 
			console.log("MetaMask is Available :) !"); 
			}
			
		// Modern DApp browsers
		if (window.ethereum) {
			window.web3 = new Web3(ethereum);
			
			// To prevent the page reloading when the MetaMask network changes
			ethereum.autoRefreshOnNetworkChange = false;
			
			// To Capture the account details from MetaMask
			const accounts = await ethereum.enable();
			account = accounts[0];
				
			}
		// Legacy DApp browsers
		else if (window.web3) {
			//window.web3 = new Web3(web3.currentProvider);
			window.web3 = new Web3(new Web3.providers.HttpProvider("https://ropsten.infura.io/v3/cbd9dc11b30147e9a2cc974be655ef7c")); 
			}
		// Non-DApp browsers
		else {
			console.log('Non-Ethereum browser detected. Please install MetaMask');
			}
			
			});
			var abi = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "approved",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "Approval",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "bool",
				"name": "approved",
				"type": "bool"
			}
		],
		"name": "ApprovalForAll",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "Transfer",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "foodtype",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "foodname",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "foodplace",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "foodpesticides",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "producersname",
				"type": "string"
			}
		],
		"name": "addProductDetails",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "approve",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "balanceOf",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "baseURI",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "fileId",
				"type": "uint256"
			}
		],
		"name": "burnMyToken",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "getApproved",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "productId",
				"type": "uint256"
			}
		],
		"name": "getProductDetails",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getProductId",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "operator",
				"type": "address"
			}
		],
		"name": "isApprovedForAll",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "fileId",
				"type": "uint256"
			}
		],
		"name": "mintMyToken",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "name",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "namedecl",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "ownerOf",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "randModulus",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "safeTransferFrom",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			},
			{
				"internalType": "bytes",
				"name": "_data",
				"type": "bytes"
			}
		],
		"name": "safeTransferFrom",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"internalType": "bool",
				"name": "approved",
				"type": "bool"
			}
		],
		"name": "setApprovalForAll",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes4",
				"name": "interfaceId",
				"type": "bytes4"
			}
		],
		"name": "supportsInterface",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "symbol",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "symboldecl",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "tokenByIndex",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "tokenOfOwnerByIndex",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "tokenURI",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "totalSupply",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "totalSupplycount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "transferFrom",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
]
var contract_address='0x43D017027692C647320816767d9196D5a912228F'
function getproductId()
{
            var myContract = new web3.eth.Contract(abi,contract_address, {from: account, gasPrice: '5000000', gas: '500000'});
             var result = myContract.methods.getProductId().call(function (err, result) {
				
				if (err) { console.log(err); }
                if (result) { 
					document.getElementById("fileid").value = result;
					
                }
               
                });
        }
		function getDetails()
{
					
				console.log("Invoking Smart Contracts - Get Student Details");
				
				//Instantiate and connect to contract address via ABI
				var myContract = new web3.eth.Contract(abi,contract_address,{from: account, gasPrice: '500000', gas:'500000'});            
										
				//call the retrieve function
				var iddd = document.getElementById("fid").value;
				console.log(iddd);
				//call the retrieve function
				var result = myContract.methods.getProductDetails(iddd).call(function (err, result) {
				
				if (err) { console.log(err); }
				if (result) { 
					
					document.getElementById("get_food_type").innerHTML = result[0]bold();
					document.getElementById("get_food_name").innerHTML = result[1]bold();
					document.getElementById("get_food_place").innerHTML = result[2].bold();
					document.getElementById("get_food_pesticides").innerHTML = result[3].bold();
					document.getElementById("get_producer_name").innerHTML = result[4].bold();
					
					
					
					
					}
				
				});
					
			
}

function del_details() {
            var myContract = new web3.eth.Contract(abi,contract_address, {from: account, gasPrice: '5000000', gas: '500000'});
            var idwe = document.getElementById("id2").value;
             var result = myContract.methods.burnMyToken(idwe).send(function (err, result) {
               
                if (err) { console.log(err); }
                if (result) { 
                    document.getElementById("result1").innerHTML = result;
                }
               
                });
        }

    </script>
</head>

<body style="background-image:"1.png";"max-width:100%;height:auto;>
	<div class="header">
  <h1>FOOD SUPPLY CHAIN</h1>
 
</div>

  <div class="row">
  <div class="column">     
        <h3 style="font-size:25px;color: black;
			text-shadow: -0px 0 black, 0 0px black, 0px 0 black, 0 -1px black;">ENTER FSC DETAILS</h3>
		
    <form position="center">

		<table style="width:43%">
		  <tr>
			<td><label for="name1">FOOD_TYPE:</label></td>
			<td><input type="text" id="food_type" name="name1"></td>
		  </tr>
		  <tr>
			<td><label for="id1">FOOD_NAME:</label></td>
			<td><input type="text" id="food_name" name="id1"></td>
		  </tr>
		  <tr>
			<td><label for="cr">FOOD_PLACE:</label></td>
			<td><input type="text" id="food_place" name="cr1"></td>
		  </tr>
		  <tr>
			<td><label for="cr">FOOD_PESTICIDES:</label></td>
			<td><input type="text" id="food_pesticides" name="br1"></td>
		  </tr>
		  
		  <tr>
			<td><label for="sub">PRODUCER:</label></td>
			<td><input type="text" id="producer_name" name="sub1"></td>
		  </tr>

		  <tr>
		  <td><tr><td><input type="button" class="button" onclick="testVariable()" value="SUBMIT"></td></td>
		  </tr>
		</table>
		<h4 style="font-size:25px;color: black;
			text-shadow: -0px 0 black, 0 0px black, 0px 0 black, 0 -1px black;"> TRANSACTION ID: <a href=""><div id="result"></div></a></h4> 
	</div>
	</form>


	<form>
		<table style="width:25%"> 
            <tr>
			<td style="font-size:25px;color: black;
			text-shadow: -0px 0 black, 0 0px black, 0px 0 black, 0 -1px black;">CLICK HERE TO GET YOUR PRODUCT_ID:</td>
			 </tr>
		  <tr>
		  <td><input type="button" class="button" onclick="getproductId()" value="GET_FILEID" color="red"></td>
		  </tr>
		</table>
		<td> <input type="text" id="fileid" value=" " > <button onclick="myFunction2()">Copy ID</button></td></td> 
	
	
	</form>
	
	<br>
       <form>
		<h3 style="font-size:25px;color: black;
			text-shadow: -0px 0 black, 0 0px black, 0px 0 black, 0 -1px black;">CURRENT  FILE DETAILS</h3>
		<table>
	<!--	<tr>
			<td> ENTER ID:</td>
			<td><input type="text" id="id1" name="id1"></td>
		  </tr>
		  </tr><input type="button" onclick="Adding_Details()" value="Add Details">
		  <input type="button"  value="Get Details">
		  -->
		  
		
		  
        
        
			<table style="width:25%">
			<tr>
				<td div style="color: black;
			text-shadow: -0px 0 black, 0 0px black, 0px 0 black, 0 -1px black;">ENTER PRODUCT ID:</td>
				<td><input type="number" id="fid" name="fid">
			</tr>
		 </table>
		 
		</form>
		</table>
			<form>
			<table>
			
			  <tr>
			  <td>FOOD_TYPE:</td>
				<td><b><div style="font-size:25px;color: yellow;
	  text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;" id="get_food_type"></b></td>
			  </tr>
			 <tr>
				<td>FOOD_NAME:</td>
				<td><b><div style="font-size:25px;color: yellow;
	  text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;" id="get_food_name"></b></td>
			  </tr>
			  <tr>
				<td>FOOD_PLACE:</td>
				<td><b><div style="font-size:25px;color: yellow;
	  text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;" id="get_food_place"></b></td>
			  </tr>
			  <tr>
				<td>FOOD_PESTICIDES:</td>
				<td><b><div style="font-size:25px;color: yellow;
	  text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;" id="get_food_pesticides"></b></td>
			  </tr>
			 
			  <tr>
				<td>PRODUCER:</td>
				<td><b><div style="font-size:25px;color: yellow;
	  text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;" id="get_producer_name"></b></td>
			  </tr>
						<tr><td><input type="button" class="button" onclick="getDetails()" value="GET_DETAILS"></td></tr>
			  </table>
			  
			</form> 

						
		        <h2>REMOVE PRODUCT</h2>
    <form style="width:25%">
		<table> 
            <tr>
			<td>ENTER_EXISTING_PRODUCT_ID:</td>
			<td><input type="text" id="id2" name="id2"></td>
		  </tr>
		  <tr>
		  <td><input type="button" class="button" onclick="del_details()" value="DELETE PRODUCT"></td>
		  </tr>
		</table>
		
		<h4> TRANSACTION ID: <a href=""><div id="result1"></div></a></h4> 
</form>
			
			</div>
			
			<br>
		<input type="button" class="button4" onclick="myFunction3()" value="Click here to redirect IPFS-PAGE">
			<br>
	<input type="button" class="button1" onclick="myFunction4()" value="HOME">
	
			</body>
		
	</html>
	
